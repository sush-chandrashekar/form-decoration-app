<?xml version="1.0" encoding="UTF-8"?>
<record_update table="sys_ui_script">
    <sys_ui_script action="INSERT_OR_UPDATE">
        <active>true</active>
        <description/>
        <global>false</global>
        <name>x_snc_formdec.formDec</name>
        <script><![CDATA[angular.module('formDec', [])
.controller('fdFieldCtrl', function ($element, $scope) {
	'use strict';
	
	$scope.focusHandler = function() {
		console.log('hasFocus');
		$scope.hasFocus = true;
		$scope.$emit("sp.spFormField.focus", $element, $scope.inputField);
	};

	$scope.blurHandler = function() {
		console.log('hasBlur');
		$scope.fieldValue($scope.field.stagedValue);
		$scope.hasFocus = false;
		$scope.$emit("sp.spFormField.blur", $element, $scope.inputField);
	};
	
})
.directive('fdFormField', function ($compile) {
	'use strict';
	
	var link = function (scope, elem, attrs, ctrl) {
		
		var directive = scope.formModel._fields[scope.field.name].directive;
		
		var el = angular.element("<" + directive + "></" + directive + ">");
		elem.find('.fd-form-field').append(el);
		$compile(el)(scope);
	};
	
	var template = '<div class="fd-form-field"></div>';
	
	var controller = function ($scope, $element) {
		
		var field = $scope.field;

		$scope.showEdit = false;
		$scope.hasError = true;
		$scope.hasChanged = false;

		$scope.clearError = function () {
			$scope.hasError = false;
		};

		extendField($scope.field);

		if (!field)
			throw "fdFormField used without providing a field.";

		function extendField(field) {
			var glideField = glideFormFieldFactory.create(field);
			field.isReadonly = glideField.isReadonly;
			field.stagedValue = field.value;

			$scope.getGlideForm().$private.events.on("change", function(fieldName, oldValue, newValue) {
				if (fieldName === field.name)
					field.stagedValue = newValue;
			});

			field.isMandatory = function() {
				return !glideField.isReadonly() && glideField.isMandatory();
			};
			field.mandatory_filled = function() {
				return glideFormFieldFactory.hasValue(field, field.stagedValue);
			};
		}

		$scope.stagedValueChange = function() {
			$scope.$emit('sp.spFormField.stagedValueChange', null);
		};

		$scope.fieldValue = function(newValue, displayValue) {
			console.log(newValue, displayValue);
			
			$scope.hasChanged = true;
			if (!field.readonly && angular.isDefined(newValue)) {
				$scope.getGlideForm().setValue(field.name, newValue, displayValue);
			}
			
			return field.value;
		};
		
	};
	
	return {
		restrict: 'E',
		template: template,
		link: link,
		scope: {
            field: '=',
            formModel: '=',
            getGlideForm: '&glideForm'
        },
		controller: controller,
		require: ['^spModel']
	};
});]]></script>
        <script_name>formDec</script_name>
        <sys_class_name>sys_ui_script</sys_class_name>
        <sys_created_by>dylan.lindgren</sys_created_by>
        <sys_created_on>2017-07-23 04:53:00</sys_created_on>
        <sys_customer_update>false</sys_customer_update>
        <sys_id>037af2b64f4443003b3028201310c7f6</sys_id>
        <sys_mod_count>68</sys_mod_count>
        <sys_name>x_snc_formdec.formDec</sys_name>
        <sys_package display_value="Form Decoration" source="x_snc_formdec">0e3afa364f4443003b3028201310c742</sys_package>
        <sys_policy/>
        <sys_replace_on_upgrade>false</sys_replace_on_upgrade>
        <sys_scope display_value="Form Decoration">0e3afa364f4443003b3028201310c742</sys_scope>
        <sys_update_name>sys_ui_script_037af2b64f4443003b3028201310c7f6</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2017-08-31 05:41:37</sys_updated_on>
        <use_scoped_format>false</use_scoped_format>
    </sys_ui_script>
</record_update>
